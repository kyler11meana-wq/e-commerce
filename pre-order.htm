<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Pre-order â€” Polaris</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous"/>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg,#f3f6f9,#e9eef5); margin:0; padding:1rem; color:#222; }
        .container { max-width:900px; margin:1rem auto; background:#fff; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.08); padding:1.25rem; }
        header { display:flex; justify-content:space-between; align-items:center; gap:1rem; }
        header a { color:#2c3e50; text-decoration:none; }
        .product { display:flex; gap:1rem; margin-top:1rem; align-items:flex-start; }
        .product img { width:260px; height:220px; object-fit:contain; background:#fff; border-radius:8px; border:1px solid #f0f0f0; }
        .details { flex:1; }
        .details h2 { margin-bottom:0.25rem; }
        .price { color:#3498db; font-weight:700; font-size:1.25rem; margin:0.5rem 0; }
        form { margin-top:0.75rem; display:grid; gap:0.6rem; }
        input, select { padding:0.6rem; border-radius:8px; border:1px solid #d8dee6; font-size:1rem; width:100%; }
        .row { display:flex; gap:0.6rem; }
        .row > * { flex:1; }
        .btn-row { display:flex; gap:0.6rem; margin-top:0.6rem; }
        button { padding:0.6rem 0.9rem; border-radius:8px; border:none; cursor:pointer; }
        .primary { background:linear-gradient(45deg,#3498db,#2980b9); color:#fff; font-weight:600; }
        .secondary { background:#fff; border:1px solid #cbd6e0; color:#2c3e50; }
        .muted { color:#6b7b8a; font-size:0.95rem; }
        .notice { padding:0.6rem; border-radius:8px; background:#e9f7ff; color:#024; margin-top:0.6rem; display:none; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <a href="homepage.htm"><i class="fas fa-arrow-left"></i> Back to store</a>
            </div>
            <div><a href="cart.htm" title="View Cart"><i class="fas fa-shopping-cart"></i></a></div>
        </header>

        <main>
            <div id="product-area" class="product">
                <img id="product-image" src="" alt="Product image"/>
                <div class="details">
                    <h2 id="product-name">Product</h2>
                    <div id="product-desc" class="muted">Pre-order description will appear here.</div>
                    <div class="price" id="product-price">$0.00</div>

                    <form id="preorder-form">
                        <label>Quantity</label>
                        <select id="quantity" name="quantity">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>

                        <div class="row">
                            <div>
                                <label>Your name</label>
                                <input id="customer-name" type="text" placeholder="Full name" required/>
                            </div>
                            <div>
                                <label>Email</label>
                                <input id="customer-email" type="email" placeholder="you@example.com" required/>
                            </div>
                        </div>

                        <label>Color (optional)</label>
                        <select id="variant">
                            <option value="Default">Default</option>
                            <option value="Black">Black</option>
                            <option value="Silver">Silver</option>
                            <option value="Blue">Blue</option>
                        </select>

                        <div class="btn-row">
                            <button type="button" id="add-to-cart" class="secondary"><i class="fas fa-cart-plus"></i> Add to cart</button>
                            <button type="submit" class="primary"><i class="fas fa-check"></i> Confirm pre-order</button>
                        </div>

                        <div id="notice" class="notice"></div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Read product details from query string
        function qs(key) {
            const params = new URLSearchParams(location.search);
            return params.get(key) || '';
        }

        const CART_KEY = 'polaris_cart_v1';
        function getCart() { try { return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); } catch(e) { return []; } }
        function saveCart(cart) { localStorage.setItem(CART_KEY, JSON.stringify(cart)); }

        // Prefill UI
        const name = decodeURIComponent(qs('name') || '');
        const price = parseFloat(qs('price') || '0');
        const img = decodeURIComponent(qs('img') || '');

        document.getElementById('product-name').textContent = name || 'Product';
        document.getElementById('product-price').textContent = price ? ('$' + Number(price).toFixed(2)) : 'Price not available';
        document.getElementById('product-image').src = img || 'https://via.placeholder.com/320x240?text=Product';
        document.getElementById('product-desc').textContent = 'Pre-order the latest product. Your pre-order will be processed and you will be contacted by email.';

        // Add to cart (from pre-order page)
        document.getElementById('add-to-cart').addEventListener('click', () => {
            const qty = parseInt(document.getElementById('quantity').value || '1', 10);
            const variant = document.getElementById('variant').value || '';
            const item = { name: name || 'Product', price: price || 0, img: img || '', variant, qty, addedAt: new Date().toISOString() };
            const cart = getCart();
            const existing = cart.find(i => i.name === item.name && i.variant === item.variant);
            if (existing) existing.qty += qty;
            else cart.push(item);
            saveCart(cart);
            showNotice('Added to cart. You can view your cart on the cart page.');
        });

        // Pre-order form confirmation (store a small record in localStorage 'polaris_preorders_v1')
        const PRE_KEY = 'polaris_preorders_v1';
        function getPreorders() { try { return JSON.parse(localStorage.getItem(PRE_KEY) || '[]'); } catch(e) { return []; } }
        function savePreorders(p) { localStorage.setItem(PRE_KEY, JSON.stringify(p)); }

        document.getElementById('preorder-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const cust = document.getElementById('customer-name').value.trim();
            const email = document.getElementById('customer-email').value.trim();
            const qty = parseInt(document.getElementById('quantity').value || '1', 10);
            const variant = document.getElementById('variant').value || '';
            if (!cust || !email) { showNotice('Please enter your name and email.'); return; }

            const pre = { product: name || 'Unknown', price: price || 0, qty, variant, customer: { name: cust, email }, createdAt: new Date().toISOString() };
            const preorders = getPreorders();
            preorders.push(pre);
            savePreorders(preorders);

            // optionally auto-add to cart as well
            const cart = getCart();
            cart.push({ name: pre.product, price: pre.price, qty: pre.qty, img, variant, addedAt: new Date().toISOString() });
            saveCart(cart);

            showNotice('Thank you! Your pre-order request has been recorded. We will contact you by email shortly.');
            // disable form after submit
            document.querySelectorAll('#preorder-form input, #preorder-form select, #preorder-form button').forEach(el => el.disabled = true);
        });

        function showNotice(msg) {
            const n = document.getElementById('notice');
            n.style.display = 'block';
            n.textContent = msg;
            setTimeout(()=> { n.style.opacity = '1'; }, 10);
        }
    </script>
</body>
</html>